<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rabbid Studio | Professional PFP Editor</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
    <style>
        :root {
            --accent: #ffcc00;
            --bg-dark: #0f172a;
            --panel: #1e293b;
            --text-main: #f1f5f9;
        }

        body {
            font-family: 'Inter', system-ui, sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            margin: 0;
            display: flex;
            height: 100vh;
        }

        /* Sidebar Design */
        .sidebar {
            width: 320px;
            background-color: var(--panel);
            padding: 2rem;
            display: flex;
            flex-direction: column;
            gap: 2rem;
            border-right: 1px solid #334155;
            box-shadow: 10px 0 15px rgba(0,0,0,0.1);
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            position: relative;
        }

        h1 { font-size: 1.5rem; margin: 0; color: var(--accent); }

        /* Professional Control Groups */
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        label { font-size: 0.85rem; font-weight: 600; color: #94a3b8; text-transform: uppercase; }

        .switch-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #0f172a;
            padding: 10px;
            border-radius: 10px;
        }

        /* Editor Workspace */
        .workspace {
            width: 500px;
            height: 500px;
            background: #000;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            border: 1px solid #334155;
        }

        img { max-width: 100%; display: block; }

        /* Professional Buttons */
        .btn {
            padding: 12px;
            border-radius: 8px;
            border: none;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .btn-primary { background: var(--accent); color: #000; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(255, 204, 0, 0.4); }
        
        .btn-outline { background: transparent; border: 1px solid #475569; color: white; }
        .btn-outline:hover { background: #334155; }

        .btn-save { background: #10b981; color: white; margin-top: auto; }

        /* Mode Toggle Switch */
        .toggle {
            position: relative; display: inline-block; width: 44px; height: 24px;
        }
        .toggle input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0;
            background-color: #475569; transition: .4s; border-radius: 24px;
        }
        .slider:before {
            position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px;
            background-color: white; transition: .4s; border-radius: 50%;
        }
        input:checked + .slider { background-color: var(--accent); }
        input:checked + .slider:before { transform: translateX(20px); }

    </style>
</head>
<body>

    <aside class="sidebar">
        <h1>RABBID STUDIO</h1>
        
        <div class="control-group">
            <label>Asset Mode</label>
            <div class="switch-container">
                <span id="modeText">Transparent</span>
                <label class="toggle">
                    <input type="checkbox" id="modeToggle" checked onchange="updateMode()">
                    <span class="slider"></span>
                </label>
            </div>
        </div>

        <div class="control-group" id="colorSection">
            <label>Background Color</label>
            <input type="color" id="bgColor" value="#ffcc00" style="width:100%; height:40px; border-radius:8px; border:none; cursor:pointer;" onchange="updateEditorBg()">
        </div>

        <div class="control-group">
            <label>Generator</label>
            <button class="btn btn-primary" onclick="rollRabbid()">ROLL NEW RABBID</button>
        </div>

        <div class="control-group">
            <label>Adjustments</label>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 5px;">
                <button class="btn btn-outline" onclick="cropper.rotate(-90)">↺ Rotate</button>
                <button class="btn btn-outline" onclick="cropper.rotate(90)">↻ Rotate</button>
                <button class="btn btn-outline" onclick="cropper.scaleX(-1)">↔ Flip</button>
                <button class="btn btn-outline" onclick="cropper.reset()">⟲ Reset</button>
            </div>
        </div>

        <button class="btn btn-save" onclick="exportPFP()">DOWNLOAD FINAL PFP</button>
    </aside>

    <main class="main-content">
        <div class="workspace" id="workspace">
            <img id="image" src="rabbids/rabbid_0.png">
        </div>
    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
    
    <script>
        let cropper;
        const image = document.getElementById('image');
        const modeToggle = document.getElementById('modeToggle');
        const workspace = document.getElementById('workspace');
        let currentPath = "rabbids/";

        // Initialize Cropper
        function initCropper() {
            if (cropper) cropper.destroy();
            cropper = new Cropper(image, {
                aspectRatio: 1,
                viewMode: 1,
                dragMode: 'move',
                autoCropArea: 0.8,
                background: false, // Hide the default grid
                ready() {
                    updateEditorBg();
                }
            });
        }

        function updateMode() {
            const isTransparent = modeToggle.checked;
            document.getElementById('modeText').innerText = isTransparent ? "Transparent" : "Original";
            currentPath = isTransparent ? "rabbids/" : "rabbids_original/";
            document.getElementById('colorSection').style.display = isTransparent ? "flex" : "none";
            
            const currentSrc = image.src.split('/').pop();
            changeImage(currentPath + currentSrc);
        }

        function updateEditorBg() {
            const container = document.querySelector('.cropper-container');
            if (container && modeToggle.checked) {
                container.style.backgroundColor = document.getElementById('bgColor').value;
            } else if (container) {
                container.style.backgroundColor = "transparent";
            }
        }

        function changeImage(src) {
            image.src = src;
            cropper.replace(src);
        }

        function rollRabbid() {
            const randomId = Math.floor(Math.random() * 60);
            changeImage(`${currentPath}rabbid_${randomId}.png`);
        }

        function exportPFP() {
            const canvas = cropper.getCroppedCanvas({
                width: 512,
                height: 512,
                fillColor: modeToggle.checked ? document.getElementById('bgColor').value : '#fff'
            });

            const link = document.createElement('a');
            link.download = 'rabbid_studio_pfp.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        }

        window.onload = initCropper;
    </script>
</body>
</html>
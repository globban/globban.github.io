<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Games Library</title>
    <style>
@font-face {
  font-family: 'dot';
  src: url('/dot.ttf');
}
body {
  margin: 0;
  color: #eee;
  background: #000;
  background-size: cover;
  background-repeat: no-repeat;
  background-attachment: fixed;
  background-position: center center;
}
.library-container {
  margin: 40px auto;
  padding: 0 24px;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(360px, 1fr));
  gap: 32px;
  justify-items: center;
}
.library-container .game-card {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
}

.game-thumb {
  z-index: 2;
  width: 340px;
  cursor: pointer;
  transition: transform 0.3s ease;
  border-radius: 20px;
  position: relative;
}
.game-card::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 340px;
  height: 100%;
  border-radius: 20px;
  transform: translate(-50%, -50%) scale(1.15);
  z-index: 1;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s;
}
.game-card:hover::before {
  opacity: 1;
  background: inherit;
  filter: blur(18px) brightness(1.2);
}
.game-thumb:hover {
  transform: scale(1.05);
}
#background {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: -1;
}

@media (max-width: 900px) {
  .library-container {
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 18px;
    padding: 0 8px;
  }
  .game-thumb {
    width: 180px;
    border-radius: 14px;
  }
  .game-card::before {
    width: 180px;
    border-radius: 14px;
  }
  h1 {
    font-size: 2.2em !important;
    padding: 8px 0 !important;
    width: 90vw !important;
    margin: 0 auto !important;
    left: unset !important;
    transform: unset !important;
    position: static !important;
  }
}

@media (max-width: 600px) {
  .library-container {
    grid-template-columns: 1fr;
    gap: 10px;
    padding: 0 2vw;
  }
  .game-thumb {
    width: 98vw;
    max-width: 340px;
    border-radius: 10px;
  }
  .game-card::before {
    width: 98vw;
    max-width: 340px;
    border-radius: 10px;
  }
  h1 {
    font-size: 1.3em !important;
    padding: 6px 0 !important;
    width: 98vw !important;
    margin: 0 auto !important;
    left: unset !important;
    transform: unset !important;
    position: static !important;
  }
}
    </style>
</head>
<body>
    <div id="background"></div>
    <h1 style="color:#ffffff; background-color: #000000b2;  width: 10em; padding: 12px 0; border-radius: 20px; position: sticky; text-align: center; left: 50vw; transform: translateX(-50%); margin-top:32px; font-weight:400; letter-spacing:0.03em;font-family: 'dot'; font-size: 5em;">Games Library</h1>
    <div class="library-container">
      <div class="game-card" data-url="https://canvas-cloc.onrender.com" data-menu="true">
            <img class="game-thumb" src="TN/draw.png" alt="Draw">
        </div>
        <div class="game-card" data-url="drift.html" data-menu="true">
            <img class="game-thumb" src="TN/Drift.png" alt="Drift">
        </div>
        <div class="game-card" data-url="life.html" data-menu="false">
            <img class="game-thumb" src="TN/life.png" alt="Life">
        </div>
        <div class="game-card" data-url="slot.html">
            <img class="game-thumb" src="TN/slot.png" alt="Slot">
        </div>
        <div class="game-card" data-url="snake.html">
            <img class="game-thumb" src="TN/Snake.png" alt="Snake">
        </div>
        <div class="game-card" data-url="https://stickmanhook2.io/game/stickman-hook/">
            <img class="game-thumb" src="TN/Hook.png" alt="Stickman">
        </div>
        <div class="game-card" data-url="tetris.html">
            <img class="game-thumb" src="TN/tetris.png" alt="Tetris">
        </div>
        <div class="game-card" data-url="https://slowroads.io/">
            <img class="game-thumb" src="TN/slowroads.png" alt="Slow Roads">
        </div>
        <div class="game-card" data-url="5050.html">
            <img class="game-thumb" src="TN/5050.png" alt="5050">
        </div>
        <div class="game-card" data-url="bloxd.html">
            <img class="game-thumb" src="TN/bloxd.png" alt="Bloxd">
        </div>
        <div class="game-card" data-url="cball.html">
            <img class="game-thumb" src="TN/cball.png" alt="Cball">
        </div>
        <div class="game-card" data-url="roulette.html">
            <img class="game-thumb" src="TN/roulette.png" alt="Roulette">
        </div>
        <div class="game-card" data-url="dvd.html">
            <img class="game-thumb" src="TN/dvd.png" alt="DVD screensaver">
        </div>
        <div class="game-card" data-url="ski.html">
            <img class="game-thumb" src="TN/ski.png" alt="Ski Game">
        </div>
    </div>
    <div id="iframe-popup" style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.8); z-index: 1000; justify-content: center; align-items: center; flex-direction: column;">
        <button id="close-btn" style="background: none; border: none; color: white; font-size: 2em; cursor: pointer; margin-bottom: 10px;">
            <i class="fa fa-times"></i>
        </button>
        <div id="iframe-wrapper" style="position: relative; width: 80vw; height: 80vh; border-radius: 12px; overflow: hidden; box-shadow: 0 0 20px rgba(255,255,255,0.2);">
            <iframe id="game-frame" allow="fullscreen" style="width: 100%; height: 100%; border: none;"></iframe>
        </div>
        <!-- Menu for games with a custom URL or original games -->
        <div id="iframe-menu" style="display: none; width: 80vw; text-align: center; margin-top: 10px;">
             <button id="fullscreen-btn" style="padding: 10px 20px; font-size: 1em;">Toggle Fullscreen</button>
        </div>
    </div>
     <script type="module">
    import { createWireframeWater } from './wireframeWater.js';

    createWireframeWater({

      container: document.getElementById('background')
    });
</script>
    <script>
function createGameCard({ title, url, thumbnail, desc, showPurpleRect }) {
  const container = document.querySelector('.library-container');
  const card = document.createElement('div');
  card.classList.add('game-card');
  // Only show the thumbnail image.
  card.innerHTML = `
     <img class="game-thumb" src="${thumbnail}" alt="${title}">
  `;
  card.addEventListener('click', () => {
    openGame(url, showPurpleRect);
  });
  container.appendChild(card);
}

function openGame(url, showPurpleRect) {
  // Popup size and dimmness settings
  const popupSize = 80;
  const popupDim = 0.8;
  const popup = document.getElementById('iframe-popup');
  const wrapper = document.getElementById('iframe-wrapper');
  popup.style.background = `rgba(0,0,0,${popupDim})`;
  wrapper.style.width = popupSize + 'vw';
  wrapper.style.height = popupSize + 'vh';

  const iframe = document.getElementById('game-frame');

  // Clean old UI
  document.getElementById('control-box')?.remove();
  document.getElementById('iframe-menu')?.remove();

  iframe.src = url;
  popup.style.display = 'flex';

  // Menu with fullscreen button
  const menu = document.createElement('div');
  menu.id = 'iframe-menu';
  menu.style.position = 'absolute';
  menu.style.bottom = '0';
  menu.style.right = '0';
  menu.style.backgroundColor = '#212233'; // dark gray
  menu.style.padding = '10px 20px';
  menu.style.zIndex = '10';
  menu.style.borderTopLeftRadius = '8px';

  const fullscreenBtn = document.createElement('button');
  fullscreenBtn.textContent = 'Fullscreen';
  fullscreenBtn.style.background = 'none';
  fullscreenBtn.style.color = 'white';
  fullscreenBtn.style.border = 'none';
  fullscreenBtn.style.cursor = 'pointer';
  fullscreenBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    if (document.fullscreenElement) {
      document.exitFullscreen();
    } else {
      wrapper.requestFullscreen();
    }
  });

  menu.appendChild(fullscreenBtn);
  wrapper.appendChild(menu);

  // Add purple control box if needed
  if (showPurpleRect) {
    const control = document.createElement('div');
    control.id = 'control-box';
    control.style.position = 'absolute';
    control.style.bottom = '0';
    control.style.left = '0';
    control.style.width = '400px';
    control.style.height = '45px';
    control.style.backgroundColor = '#212233'; // dark gray
    control.style.zIndex = '10';
    wrapper.appendChild(control);
  }
}

function closePopup() {
  document.getElementById('iframe-popup').style.display = 'none';
  document.getElementById('game-frame').src = '';
  document.getElementById('control-box')?.remove();
  document.getElementById('iframe-menu')?.remove();
}

document.getElementById('close-btn').addEventListener('click', closePopup);
document.getElementById('iframe-popup').addEventListener('click', (e) => {
  if (e.target === e.currentTarget) closePopup();
});

// Load static HTML cards (manually defined ones)
document.querySelectorAll('.library-container .game-card').forEach(card => {
  const url = card.dataset.url || card.getAttribute('onclick')?.match(/'(.*?)'/)?.[1];
  if (!url) return;

  // Remove inline onclick to avoid navigation
  card.removeAttribute('onclick');

  // Click opens in popup with no purple rect (since they aren't from games.json)
  card.addEventListener('click', () => {
    openGame(url, false);
  });
});

// Load games from games.json
fetch('games.json')
  .then(res => res.json())
  .then(games => {
    games.forEach(game => {
      const url = game.customurl 
        ? game.customurl 
        : `https://games.crazygames.com/en_US/${game.gameid}/index.html?skipPrerollFirstSession=true&v=1.337`;
      const title = game.gameid
        .split('-')
        .map(w => w.charAt(0).toUpperCase() + w.slice(1))
        .join(' ');
      createGameCard({
        title,
        url,
        thumbnail: game.thumbnail,
        desc: game.desc,
        showPurpleRect: !game.customurl
      });
    });
  })
  .catch(err => console.error('Failed to load games.json:', err));
</script>


</body>
</html>
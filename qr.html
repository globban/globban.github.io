<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>QR Generator</title>
<style>
  body {
    margin: 0;
    font-family: "Inter", system-ui, Segoe UI, Roboto, Arial, sans-serif;
    min-height: 100vh;
    background: #000000;
    background-size: cover;
    background-position: center;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    color: #f1f5f9;
  }
  .wrap { width:100%;max-width:960px;margin:60px auto;padding:20px;box-sizing:border-box; }
  .card {
    backdrop-filter: blur(18px) saturate(180%);
    background: rgba(255,255,255,0.12);
    border: 1px solid rgba(255,255,255,0.25);
    border-radius: 20px;
    padding: 24px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.3);
  }
  h1 { margin:0;font-size:22px;font-weight:600;color:#fff; }
  label { font-size:13px;opacity:0.85;display:block;margin-bottom:6px; }
  textarea, select, input[type="range"], input[type="color"], input[type="file"] {
    width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.25);
    background:rgba(255,255,255,0.1);color:#f8fafc;outline:none;font-size:14px;
  }
  textarea { min-height:84px;resize:vertical;padding:10px; }
  textarea:focus, select:focus, input:focus { border-color:#38bdf8;background:rgba(255,255,255,0.15); }
  ::file-selector-button {
    background:rgba(255,255,255,0.2);border:none;border-radius:6px;color:#fff;padding:5px 10px;cursor:pointer;margin-right:8px;
  }
  .row { display:flex;gap:12px;margin-top:12px;flex-wrap:wrap; }
  .col { flex:1; }
  .controls { display:flex;gap:8px;flex-wrap:wrap;margin-top:16px; }
  button {
    background:linear-gradient(90deg,#38bdf8,#06b6d4);border:none;padding:10px 16px;
    color:#fff;border-radius:10px;cursor:pointer;font-weight:500;transition:0.2s;
  }
  button:hover { transform:translateY(-2px);box-shadow:0 4px 14px rgba(6,182,212,0.4); }
  button.secondary { background:rgba(255,255,255,0.15);border:1px solid rgba(255,255,255,0.3); }
  .preview { display:flex;gap:18px;align-items:center;margin-top:24px;flex-wrap:wrap;justify-content:center; }
  .preview-box {
    background:rgba(255,255,255,0.1);padding:16px;border-radius:12px;
    display:flex;align-items:center;justify-content:center;
    border:1px solid rgba(255,255,255,0.2);
  }
  footer { margin-top:14px;font-size:13px;opacity:0.7;text-align:center; }
  code { background:rgba(255,255,255,0.15);padding:2px 5px;border-radius:4px;color:#38bdf8; }
  #background { position:fixed;top:0;left:0;width:100%;height:100%;object-fit:cover;z-index:-1; }
</style>
</head>
<body>
  <iframe id="background" src="/topo.html" frameborder="0"></iframe>
<div class="wrap">
  <div class="card">
    <header style="display:flex;justify-content:space-between;align-items:center">
      <h1>QR Generator</h1>
      <div style="opacity:.7;font-size:13px">No build step · with styles</div>
    </header>

    <div style="margin-top:12px">
      <label>Type</label>
      <select id="type">
        <option value="text">Text / URL</option>
        <option value="url">URL</option>
        <option value="wifi">Wi‑Fi</option>
        <option value="mailto">Email (mailto)</option>
        <option value="gmail">Gmail (compose)</option>
        <option value="tel">Phone (tel)</option>
        <option value="sms">SMS</option>
      </select>

      <div id="textBlock">
        <label style="margin-top:8px">Content / URL / Text</label>
        <textarea id="text">https://algot.fun</textarea>
      </div>

      <div id="extras" style="margin-top:8px">
        <div id="wifiFields" style="display:none">
          <label>SSID</label>
          <input id="wifiSsid" placeholder="MyNetwork" />
          <label>Password</label>
          <input id="wifiPass" placeholder="password" />
          <label>Encryption</label>
          <select id="wifiEnc"><option value="WPA">WPA/WPA2</option><option value="WEP">WEP</option><option value="nopass">None</option></select>
          <label><input type="checkbox" id="wifiHidden" /> Hidden network</label>
        </div>

        <div id="mailFields" style="display:none">
          <label>To</label>
          <input id="mailTo" placeholder="name@example.com" />
          <label>Subject</label>
          <input id="mailSub" placeholder="Subject" />
          <label>Body</label>
          <textarea id="mailBody" placeholder="Message body"></textarea>
        </div>

        <div id="gmailFields" style="display:none">
          <label>To</label>
          <input id="gmailTo" placeholder="name@example.com" />
          <label>Subject</label>
          <input id="gmailSub" placeholder="Subject" />
          <label>Body</label>
          <textarea id="gmailBody" placeholder="Message body"></textarea>
        </div>

        <div id="telFields" style="display:none">
          <label>Phone</label>
          <input id="telNum" placeholder="+1234567890" />
        </div>

        <div id="smsFields" style="display:none">
          <label>Phone</label>
          <input id="smsNum" placeholder="+1234567890" />
          <label>Message</label>
          <input id="smsBody" placeholder="SMS message" />
        </div>

        
      </div>

      <div class="row">
        <div class="col">
          <label>Size: <span id="sizeVal">300</span>px</label>
          <input id="size" type="range" min="128" max="1024" value="300">
        </div>

        <div style="width:160px">
          <label>Error correction</label>
          <select id="level">
            <option value="L">L</option><option value="M" selected>M</option>
            <option value="Q">Q</option><option value="H">H</option>
          </select>
        </div>

        <div style="width:200px">
          <label>Style</label>
          <!-- note: fluid renamed to extra-rounded/classy etc. -->
          <select id="style">
            <option value="square">Square</option>
            <option value="dots">Dots</option>
            <option value="rounded">Rounded</option>
            <option value="classy">Classy</option>
            <option value="classy-rounded">Classy Rounded</option>
            <option value="extra-rounded">Extra Rounded (fluid)</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div style="width:120px">
          <label>Foreground</label><input id="fg" type="color" value="#111827">
        </div>
        <div style="width:120px">
          <label>Background</label><input id="bg" type="color" value="#ffffff">
        </div>
        <div style="flex:1">
          <label>Logo (optional)</label>
          <input id="logo" type="file" accept="image/*">
        </div>
      </div>

      <div class="controls">
        <button id="generate">Generate</button>
        <button id="downloadPng" class="secondary">Download PNG</button>
        <button id="downloadSvg" class="secondary">Download SVG</button>
      </div>

      <div class="preview"><div class="preview-box" id="qrBox"></div></div>
      <footer>Powered by <code>qr-code-styling</code></footer>
    </div>
  </div>
</div>

<!-- QR library -->
<script src="https://cdn.jsdelivr.net/npm/qr-code-styling@1.5.0/lib/qr-code-styling.js"></script>
<script>
const qrBox = document.getElementById("qrBox");
const textEl = document.getElementById("text");
const typeEl = document.getElementById("type");
// wifi fields
const wifiSsid = document.getElementById('wifiSsid');
const wifiPass = document.getElementById('wifiPass');
const wifiEnc = document.getElementById('wifiEnc');
const wifiHidden = document.getElementById('wifiHidden');
// mail/gmail
const mailTo = document.getElementById('mailTo');
const mailSub = document.getElementById('mailSub');
const mailBody = document.getElementById('mailBody');
const gmailTo = document.getElementById('gmailTo');
const gmailSub = document.getElementById('gmailSub');
const gmailBody = document.getElementById('gmailBody');
// tel/sms
const telNum = document.getElementById('telNum');
const smsNum = document.getElementById('smsNum');
const smsBody = document.getElementById('smsBody');
const sizeEl = document.getElementById("size");
const sizeVal = document.getElementById("sizeVal");
const levelEl = document.getElementById("level");
const fgEl = document.getElementById("fg");
const bgEl = document.getElementById("bg");
const styleEl = document.getElementById("style");
const logoEl = document.getElementById("logo");
const downloadPngBtn = document.getElementById("downloadPng");
const downloadSvgBtn = document.getElementById("downloadSvg");

let lastLogoObjectUrl = null;

let qr = new QRCodeStyling({
  width: 300,
  height: 300,
  type: "canvas",        // canvas for PNG; we'll also support SVG download
  data: textEl.value,
  image: "",
  dotsOptions: { color: fgEl.value, type: "square" },
  backgroundOptions: { color: bgEl.value },
  qrOptions: { errorCorrectionLevel: levelEl.value }
});
qr.append(qrBox);

function show(id, v){ document.getElementById(id).style.display = v ? '' : 'none'; }

function updateFieldsVisibility(){
  const t = typeEl.value;
  // show main text box only for text and url types
  show('textBlock', t === 'text' || t === 'url');
  show('wifiFields', t === 'wifi');
  show('mailFields', t === 'mailto');
  show('gmailFields', t === 'gmail');
  show('telFields', t === 'tel');
  show('smsFields', t === 'sms');
}

function escWi(s){ return (s||'').replace(/([\\;,:])/g,'\\$1'); }


function getDotType(style) {
  // map select value to supported qr-code-styling types
  // valid types: 'square','dots','rounded','classy','classy-rounded','extra-rounded'
  const valid = ['square','dots','rounded','classy','classy-rounded','extra-rounded'];
  return valid.includes(style) ? style : 'square';
}

async function generate() {
  const dotType = getDotType(styleEl.value);
  const size = Number(sizeEl.value) || 300;
  const fg = fgEl.value || '#111827';
  const bg = bgEl.value || '#ffffff';
  const level = levelEl.value || 'M';

  // Build payload depending on selected type
  let data = '';
  const t = typeEl.value;
  const raw = (textEl.value || '').trim();

  if (t === 'wifi'){
    const ssid = escWi(wifiSsid.value || raw || '');
    const enc = (wifiEnc.value || 'WPA');
    const pass = escWi(wifiPass.value || '');
    const hidden = wifiHidden.checked ? 'true' : 'false';
    if (enc === 'nopass'){
      data = `WIFI:T:nopass;S:${ssid};H:${hidden};;`;
    } else {
      data = `WIFI:T:${enc};S:${ssid};P:${pass};H:${hidden};;`;
    }
  } else if (t === 'mailto'){
    const to = mailTo.value || raw || '';
    const sub = encodeURIComponent(mailSub.value || '');
    const body = encodeURIComponent(mailBody.value || '');
    data = `mailto:${to}` + ((sub||body) ? `?subject=${sub}&body=${body}` : '');
  } else if (t === 'gmail'){
    const to = gmailTo.value || raw || '';
    const sub = encodeURIComponent(gmailSub.value || '');
    const body = encodeURIComponent(gmailBody.value || '');
    data = `https://mail.google.com/mail/?view=cm&fs=1&to=${encodeURIComponent(to)}${sub?`&su=${sub}`:''}${body?`&body=${body}`:''}`;
  } else if (t === 'tel'){
    const num = telNum.value || raw || '';
    data = `tel:${num}`;
  } else if (t === 'sms'){
    const num = smsNum.value || raw || '';
    const msg = smsBody.value || '';
    // SMSTO:number:message is widely supported
    data = `SMSTO:${num}:${msg}`;
  } else if (t === 'url'){
    let url = raw;
    if (!/^https?:\/\//i.test(url)) url = 'https://' + url;
    data = url;
  } else {
    // text (default)
    data = raw;
  }

  // If a new logo file was chosen, create an object URL and update
  if (lastLogoObjectUrl) {
    // revoke previous to avoid leaking memory
    URL.revokeObjectURL(lastLogoObjectUrl);
    lastLogoObjectUrl = null;
  }

  let imageUrl = "";
  if (logoEl.files && logoEl.files[0]) {
    imageUrl = URL.createObjectURL(logoEl.files[0]);
    lastLogoObjectUrl = imageUrl;
  }

  qr.update({
    width: size,
    height: size,
    data,
    image: imageUrl,
    dotsOptions: { color: fg, type: dotType },
    backgroundOptions: { color: bg },
    qrOptions: { errorCorrectionLevel: level }
  });
}

// download helpers
downloadPngBtn.addEventListener('click', () => {
  // png download (canvas)
  qr.download({ name: "qr", extension: "png" });
});

downloadSvgBtn.addEventListener('click', () => {
  // svg download (works even if initial type was canvas)
  qr.download({ name: "qr", extension: "svg" });
});

sizeEl.oninput = () => sizeVal.textContent = sizeEl.value;
document.getElementById("generate").onclick = generate;

// show/hide extra fields when type changes
typeEl.addEventListener('change', updateFieldsVisibility);
updateFieldsVisibility();

// regenerate when inputs change for convenience
[textEl, typeEl, sizeEl, levelEl, fgEl, bgEl, styleEl, logoEl,
 wifiSsid, wifiPass, wifiEnc, wifiHidden,
 mailTo, mailSub, mailBody, gmailTo, gmailSub, gmailBody,
 telNum, smsNum, smsBody].forEach(el => { if (el) el.addEventListener('change', generate); });

window.addEventListener('load', generate);
</script>
</body>
</html>
